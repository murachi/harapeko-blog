<h1>Perl モジュールと同じ場所にある設定ファイルを読み込む</h1>

<div class="entry">
<p>ブログがあまりにもほったらかしすぎなので、今後は極力些細な内容でも積極的にエントリを上げていこうと思います。</p>
<p>Perl での開発で、自分で作っているモジュールのファイルと同じ場所にあるファイルを設定ファイルとして読み込みたい場合があります。その設定ファイルも Perl モジュールとして書いてしまうのはやり方としては悪くないのですが、単なる定数値の羅列としてではなく、 YAML などで書きたくなるような若干複雑な構造のファイルもあるので、その場合、ファイルの場所を特定する方法が必要になります。<br/>
<span id="more-156"></span><br/>
読み込まれたモジュールファイルの場所は、 %INC 特殊変数に記録されています。キーに、モジュールのファイル名を指定すれば、そのファイルの場所を取得できます。</p>
<pre>
%perl -Mstrict -e 'print qq/$INC{"strict.pm"}\n/'
/usr/local/lib/perl5/5.8.9/strict.pm
%
</pre>
<p>モジュールファイルがカレントディレクトリにある場合、その値はキーと同じファイル名のみになるようです。</p>
<p>%INC はそのモジュールファイルの読み込みを開始する時点で既にセットされるようなので、自身のモジュールファイル内であれば、たとえ BEGIN 節であっても参照できます。</p>
<pre>
package Hoge;

BEGIN {
    print "$INC{'Hoge.pm'}\n";
}

1;
</pre>
<p>設定ファイルの場所を特定して読み込むのは、以下の要領で書けば実現できるでしょう。</p>
<pre>
package Hoge;
use strict;
use YAML;

BEGIN {
    my $conf_path = ($INC{'Hoge.pm'} =~ (m!^((?:.+/)?)Hoge.pm$!)[0] . '/conf.yml';
    my $yaml = LoadFile($conf_path);

    # ...処理...
}

# ...

1;
</pre>
<p><small>2011 年 8 月 30 日 by 村山 俊之</small></p>


</div>

<p>(転載元: はらぺこ日誌 〜株式会社はらぺこ 公式ブログ〜)</p>
