[author: murachi]
# システム概要 (要件定義)

## 動作環境

一般的な LAMP 環境を想定する。当面は[さくらのレンサバ スタンダードプラン](http:://www.sakura.ne.jp/rentalserver/standard/index.html)での運用を前提とする。

* OS: GNU/Linux 、またはその他の Unix ライクな環境。
* Webサーバー: Apache 2.x<small> (特に mod_perl を採用する場合、 1.x 系はサポート対象外とする。) </small>
* DBMS: MySQL
* サーバーサイドプログラム言語: Perl 5.8/5.10<small> (当面は CGI で動作するものを実装する。) </small>
* 対応ブラウザ: HTML4.01/XHTML1.1、CSS1/2、JavaScript1.5 標準に準拠したもの。 IE、Gecko、WebKit、Opera を想定。

[[FootNote]]

## 機能要件

### 必要な機能

* スレッド型掲示板。
  * コメント単位でのスレッディングには非対応。コメント番号を用いた参照で代用する。
* ユーザー識別。
  * 当面はユーザー認証を前提とし、事前登録したユーザーに紐づけてユーザー名を表示する。
* スレッド投稿、修正、閉鎖、削除。
  * 削除は管理者のみ可能。修正、閉鎖は管理者とスレッド投稿者のみ可能。閉鎖したスレッドは元には戻せず、コメントの投稿、修正、削除も受け付けなくなる。
* コメント投稿、修正、削除。
  * 修正、削除は管理者とコメント投稿者のみ可能。
  * 修正を加えた場合、修正を加えた日時が表示される。
* スレッド一覧表示。
  * 変更 (スレッド修正、閉鎖、コメント投稿、修正、削除) が加えられた日時の新しい順にソートして一覧表示する。
* オートリンク。
  * 「>>数字」は数字の番号コメントへのリンクとなる。
  * 「thread:数字」は数字の番号スレッドへのリンクとなる。
    * 「[テキスト](thread::数字)」と書くと、リンクの表示文字がテキストに置き換わる。
    * 「thread:数字1:数字2」と書くと、数字1番スレッドの、数字2番コメントへのリンクとなる。「[テキスト](thread::数字1:数字2)」と書くこともできる。
  * コロン ":" の手前が http、ftp、https、ftps、mailto で始まる文字列は、可能な限り URI として解釈し、その URI へのリンクとなる。
    * 「[URI テキスト]」と書くと、リンクの表示文字がテキストに置き換わる。

### 欲しい機能

* ファイル添付。
  * 添付ファイルが画像の場合はコメントの冒頭に表示する。
* URI が画像ファイルを指すものである場合、画像ファイルへのディープリンクになる。
  * 余所様のリンク先サイトにご迷惑をおかけしてはいけないので、ディープリンク可能な URI プレフィックスを管理者が事前に登録する方式をとる。プレフィックスが登録されていない URI の画像をディープリンクしようとした場合は、単に URI をリンクとして表示する。
* URI が YouTube またはニコニコ動画の動画を指すものである場合、動画そのものを埋め込み表示する。
* 全文検索。
* ユーザー登録、設定。
  * 登録申請画面、および各種設定画面。
* スレッドアクセス制御。
  * スレッドごとに、非ユーザーへのアクセス制御を設定できるようにする。選択肢は以下の通り。
    * 「コメント可」 ... 非ユーザーが閲覧でき、コメントを書き込むこともできる。
    * 「閲覧可」 ... 非ユーザーが閲覧できるが、コメントは書き込めない。
    * 「非公開」 ... 非ユーザーは閲覧できない。
* RSS 配信。
  * 全スレッドのコメントを RSS として配信する。
  * スレッドアクセス制御機能を前提とし、「非公開」のスレッドについてはコメント番号のみを配信する。
* ケータイ対応。
  * 別 URI にて対応。
  * JavaScript は使用しない。
  * 100KB 制限に留意した実装。
    * スレッドページではスレッドコメントは概要のみ表示。
      * スレッドコメント全文表示は別ページで。
    * コメントは 10 ずつ表示。 500 文字を超えるコメントは 500文字で切って表示し、全文表示用のリンクを出す。
    * 添付画像のサムネイルは 64px 程度のアイコンサイズとし、 2KB 以下に変換して出力する。サムネイルは画像へのリンクになるが、その画像も 100KB 以下に変換して出力する。画像以外の添付ファイルは添付されていることを示すのみとする。
